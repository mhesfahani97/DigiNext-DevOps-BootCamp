load_module /usr/lib/nginx/modules/ngx_stream_module.so;
user esi;
worker_processes auto;
error_log /var/log/nginx/error.log;
pid /run/nginx.pid;

events {
        worker_connections 2048;
}

stream {
	upstream tcp_check {
		server 127.0.0.1:81;
	        server 127.0.0.1:82;
	}
	server {
		listen 8081;
		proxy_pass tcp_check;
	}
}

http {
        upstream lb {
		ip_hash;
                server 127.0.0.1:81;
                server 127.0.0.1:82;
        }
        server {
                listen  80;
                location / {
                        error_log /var/log/nginx/error_root.log;
                        access_log /var/log/nginx/access_root.log;
                        proxy_pass http://lb;
                }
        }
        server {
                listen 81;
                location / {
                        root /var/www/nginx/server1;
                }
        }
        server{
                listen 82;
                location / {
                        root /var/www/nginx/server2;
                }
        }
}





































































